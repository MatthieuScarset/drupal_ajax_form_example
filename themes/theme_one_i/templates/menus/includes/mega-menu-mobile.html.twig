

{% import _self as mega_menu_mobile %}

{#
We call a macro which calls itself to render the full tree.
@see http://twig.sensiolabs.org/doc/tags/macro.html
#}

{{ mega_menu_mobile.menu_links_mobile(items, attributes, 0) }}

{% macro menu_links_mobile(items, attributes, menu_level) %}
  {% if items %}
    <div class="root-navbar-mobile navbar-nav">
      <div class="mega-menu-panel">
        <div class="container">
          <div class="welcome-text pt-2 mb-1">
            <p>{{ "Welcome on international website"|t }} </p>
          </div>
          <ul class="navbar-nav">
            {{ _self.menu_row(items, 0) }}
          </ul>
        </div>
      </div>
    </div>
  {% endif %}
{% endmacro %}


{% macro menu_row(items, menu_level, item_parent = null, item_initial = null) %}
  {% for item in items %}
    <li class="nav-item chevron-black" data-menu-level="{{ menu_level }}">
      {% if item.below %}
        {% if menu_level == 0 %}
          <a class="nav-link text-dark"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item.title }}')">
            {{ item.title }}
          </a>

        {% else %}
          <a class="nav-link text-dark"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_parent }}','{{ item.title }}')">
            {{ item.title }}
          </a>

        {% endif %}


        <ul class="navbar-nav items-level-2">

          <li class="nav-item top-back-zone my-1">
            <a class="nav-link back text-dark font-weight-bold py-2" role="menuitem"
               aria-label="Go back to {{ item.title }}">
              {{ item.title }}
            </a>
          </li>

          {% if menu_level == 1 %}
            <li class="nav-item">
              <a class="o-link-arrow ob1-link-dark all-product-link-mobile" href="{{ item.url }}"
                 onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item.parent }}_{{ item.title }}','{{ "See all products" | t }}');">
                {{ "See all products" | t }}
              </a>

              <p class="en-ce-moment-mobile mt-2">{{ "At the moment" | t }}</p>

            </li>
          {% endif %}

          {% if menu_level == 0 %}
            {% set item_initial = item.title %}
            {% if (item.content.field_template['#items'].value == 0) %}
              {{ _self.old_template(item.below, item.title) }}
            {% else %}
              {{ _self.menu_row(item.below, menu_level + 1, item.title, item_initial) }}
            {% endif %}
          {% else %}
            {{ _self.menu_row(item.below, menu_level + 1, item.title, item_initial) }}
          {% endif %}

        </ul>

      {% else %}
        {% if item.entity.field_teaser.value is empty %}
          <a href="{{ item.url }}" class="nav-link text-dark" role="menuitem"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item.title }}')">{{ item.title }} </a>
        {% else %}
          <a href="{{ item.url }}" class="nav-link items-level-3 text-dark font-weight-bold"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_initial }}_{{ item_parent }}','{{ item.title }}');">{{ item.title }}
            <p class="field-teaser-mobile font-weight-normal mr-1"> {{ item.entity.field_teaser.value }} </p>
          </a>
          <hr class="separator separator--gray4 mr-1">

        {% endif %}
      {% endif %}
    </li>
  {% endfor %}
{% endmacro %}


{# Gestion du cas "old template" ou tous les items sont à la suite, malgré 2 sous-niveaux   #}
{% macro old_template(items, item_parent) %}
  {% for item in items %}
    <a href="{{ item.url }}" class="nav-link text-dark" role="menuitem"
       onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_parent }}','{{ item.title }}')">{{ item.title }} </a>
    {% if item.below %}
      {% for item in item.below %}
        <a href="{{ item.url }}" class="nav-link text-dark" role="menuitem"
           onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_parent }}','{{ item.title }}')">{{ item.title }} </a>
      {% endfor %}
    {% endif %}
  {% endfor %}
{% endmacro %}
