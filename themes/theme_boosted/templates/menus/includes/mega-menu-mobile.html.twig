{% macro menu_links_mobile(items, attributes, menu_level) %}
  {% if items %}
    <div class="mega-menu-mobile hidden-lg">
      <ul class="main-items-menu" data-menu-level="0">
        {{ _self.menu_row(items, 0) }}
      </ul>
    </div>
  {% endif %}
{% endmacro %}


{% macro menu_row(items, menu_level, item_parent = null, item_initial= null) %}
  {% if menu_level == 0 %}
    <div class="welcome_text">
      <p>{{ "Welcome on international website"|t }} </p>
    </div>
  {% endif %}
  {% for item in items %}
    <li class="items-mobile-{{ menu_level }}" >
      {% if item.below %}
        {% if menu_level == 0 %}
          <a class="o-link-arrow beyond" data-menu-level-target="{{ menu_level + 1 }}"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item.title }}')">
            {{ item.title }}
          </a>

        {% else %}
          <a class="o-link-arrow beyond" data-menu-level-target="{{ menu_level + 1 }}"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_parent }}','{{ item.title }}')">
            {{ item.title }}
          </a>
        {% endif %}

        <ul class="items-mobile hidden" data-menu-level="{{ menu_level + 1 }}">
          <li class="items-mobile-back previous">
            <a class="o-link-arrow back" data-menu-level-target="{{ menu_level }}">
              {{ item.title }}
            </a>
          </li>

          {% if menu_level == 1 %}
            <li>
              <a class="o-link-arrow all-product-link-mobile" href="{{ item.url }}"
                 onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_parent }}_{{ item.title }}','{{ "See all products" | t }}');">
                {{ "See all products" | t }}
              </a>

              <p class="en-ce-moment-mobile">{{ "At the moment" | t }}</p>

            </li>
          {% endif %}

          {% if menu_level == 0 %}
            {% set item_initial = item.title %}
            {% if (item.content.field_template['#items'].value == 0) %}
              {{ _self.old_template(item.below, item.title) }}
            {% else %}
              {{ _self.menu_row(item.below, menu_level + 1, item.title, item_initial) }}
            {% endif %}
          {% else %}
            {{ _self.menu_row(item.below, menu_level + 1, item.title, item_initial) }}
          {% endif %}

        </ul>

      {% else %}
        {% if item.entity.field_teaser.value is empty %}
            <a class="o-link-arrow" href="{{ item.url }}"
               onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item.title }}')"> {{ item.title }} </a>
        {% else %}
          <a class="items-level-{{ menu_level + 1 }}" href="{{ item.url }}"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_initial }}_{{ item_parent }}','{{ item.title }}');">{{ item.title }}
            <p class="field-teaser-mobile"> {{ item.entity.field_teaser.value }} </p>
          </a>
          <hr class="separateur">
        {% endif %}
      {% endif %}
    </li>
  {% endfor %}
{% endmacro %}


{# Gestion du cas "old template" ou tous les items sont à la suite, malgré 2 sous-niveaux   #}
{% macro old_template(items, item_parent) %}

  <li>
    {% for item in items %}
      <a class="o-link-arrow" href="{{ item.url }}"
         onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_parent }}','{{ item.title }}')">{{ item.title }} </a>
      {% if item.below %}
        {% for item in item.below %}
        <li>
          <a class="o-link-arrow" href="{{ item.url }}"
             onmousedown="utag_link(utag_data.titre_page,'Menu','{{ item_parent }}','{{ item.title }}')">{{ item.title }} </a>
        </li>
        {% endfor %}
      {% endif %}
    {% endfor %}
  </li>
{% endmacro %}
